name: iOS Workflow

on:
  push:
    branches:
      - main  # Trigger only on pushes to the main branch

jobs:
  build:
    name: Build iOS App
    runs-on: macos-latest  # Use a macOS runner for iOS builds

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Xcode
        run: |
          sudo xcode-select --switch /Applications/Xcode_14.2.app  # Specify your Xcode version
          xcodebuild -version

      - name: Install dependencies
        run: |
          brew install cocoapods  # Install CocoaPods if needed
          pod install

      - name: Build iOS App
        run: |
          xcodebuild \
            -workspace YourApp.xcworkspace \
            -scheme YourAppScheme \
            -sdk iphoneos \
            -configuration Release \
            CODE_SIGN_IDENTITY="iPhone Distribution" \
            DEVELOPMENT_TEAM=YOUR_TEAM_ID \
            PROVISIONING_PROFILE_SPECIFIER="Your_Provisioning_Profile" \
            clean build

      - name: Publish to App Store
        env:
          APP_STORE_API_KEY: ${{ secrets.APP_STORE_API_KEY }}
        run: |
          xcodebuild \
            -exportArchive \
            -archivePath YourApp.xcarchive \
            -exportOptionsPlist ExportOptions.plist \
            -exportPath . \
            -allowProvisioningUpdates